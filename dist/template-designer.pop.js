!async function(){"use strict";window.POP_CANVAS_SIZE=1e3,window.POPLastAction=null;let e={"x-less-version":0x13501e3},t=e=>window.URL?new window.URL(window.location.href).searchParams.get(e):null,i=()=>{let e=t("pop_origin");return null!==e?e:"https://cdn.jsdelivr.net/gh/pop-template-designer/resources/dist"},n=()=>{let e=t("pop_api");return null!==e?e:"https://i.popcustoms.com"},o=`${i()}/index.pop20251107.html`,a=[{type:"script",url:"https://cdn.jsdelivr.net/gh/pop-template-designer/resources/libraries/template-designer-resources-20250829.js"}],r=[{type:"script",url:`${i()}/index.pop20251107.js`,isModuleType:!0},{type:"style",url:`${i()}/index.pop20251107.css`}],s=e=>new Promise(t=>setTimeout(t,e));async function l(e,t=[]){for(let i of t)await function(t){return new Promise((i,n)=>{let o=document.createElement("script"===t.type?"script":"link"),a=t.url;"script"===t.type?o.src=a:(o.rel="stylesheet",o.href=a),o.onload=()=>{i()},o.onerror=e=>{n(e)},e.appendChild(o)})}(i)}function d(e,t,i){let n=new MutationObserver(t=>{t.forEach(t=>{e(t)})});return n.observe(t,i),n}function p(e,t,i){e.postMessage({action:t,...i},"*")}function u(e,t,i){e&&e.addEventListener(t,i)}let c=(e,t={},i={},n="")=>{let o=document.createElement(e);return Object.keys(t).forEach(e=>o.setAttribute(e,t[e])),Object.keys(i).forEach(e=>o.style[e]=i[e]),o.innerHTML=n,o},h="pop_",g="pop-form-processed",m={},f={},w="popTemplateDesignerApp";var y={galleryType:"media-gallery",isVisible(e){let t=window.getComputedStyle(e);return"hidden"!==t.visibility&&"none"!==t.display&&(e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0)&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},isPopProductImage(e){let t=(e.currentSrc||e.src).split("?")[0].split("/").pop();return window.popLog?.log("formattedSrc",t),t.includes("1yzaosWlrn")},sortByWidth:e=>e,filterByOffset(e){let t=e.getBoundingClientRect(),i=t.top;t.left;let n=i+document.documentElement.scrollTop;return window.popLog?.log("filterByOffset",e,n,n-window.pageYOffset,window.innerHeight/2,n-window.scrollY<window.innerHeight/2),!n||n-window.pageYOffset<window.innerHeight/2},findProductImages(){let e=Array.from(document.querySelectorAll("img")),t=[];for(let i of e)this.isVisible(i)&&this.isPopProductImage(i)&&t.push(i);return t},findMainProductImage(e=[]){e.length;let t=this.sortByWidth(e);if("media-gallery"!==this.galleryType)return null;for(let e of t)if(e.closest(".is-active"))return e},findProductThumbs(e){let t=[];for(let i of this.sortByWidth(e))this.isVisible(i)&&(i.offsetWidth>200||t.push(i));return t},findTargetThumb(e){return this.sortByWidth(e)[0]},parentsWithLimit(e,t,i){let n=e;for(let e=0;e<i;e++)if((n=n.parentElement)&&n.querySelector(t))return n;return null},setGalleryType(e){let t=this.parentsWithLimit(e,"media-gallery slider-component",7);window.popLog?.log("setGalleryType",t),t&&(window.popLog?.log("setGalleryType",t),this.stickyMediaGallery(t),this.galleryType="media-gallery")},stickyMediaGallery(e){e.setAttribute("style","position: sticky; top: 0;")},finder(){let e=this.findProductImages();e.length>0&&this.setGalleryType(e[0]);let t=this.findMainProductImage(e);window.popLog?.log("mainImage",t);let i=this.findProductThumbs(e);window.popLog?.log("thumbs",i);let n=this.findTargetThumb(i);return window.popLog?.log("targetThumb",n),{images:e,mainImage:t,thumbs:i,targetThumb:n}}},v={previewImageModal:null,previewImage:null,create(){this.destroy();let e=c("style");e.innerHTML=".pop-preview-image-modal{display: none;position: fixed; z-index: 2147483648; top: 0; width: 100%; height: 100%; left: 0; background: rgba(0, 0 , 0, 0.6); box-sizing: border-box; justify-content: center; align-items: center;}.pop-preview-image-wrap{position: relative;max-width: min(90vw, 90vh);max-height: min(90vw, 90vh);padding: 10px;background: #fff;border-radius: 4px;}.pop-preview-image-placeholder{display: block !important;width: calc(min(90vw, 90vh) - 20px);height: calc(min(90vw, 90vh) - 20px);}.pop-preview-image{display: none;width: calc(100% - 20px); height: calc(100% - 20px); object-fit: contain;position: absolute;top: 10px;left: 10px;bottom: 10px;right: 10px;}";let t=document.createElement("div");t.appendChild(e),t.className="pop-preview-image-modal";let i=document.createElement("div");i.className="pop-preview-image-wrap";let n=document.createElement("div");n.className="pop-preview-image-placeholder",i.appendChild(n);let o=document.createElement("span");o.onclick=this.close.bind(this),o.setAttribute("style","z-index:1;height:30px; width:30px; cursor:pointer;background: lightgrey;border-radius: 50%; position: absolute; right: -15px; top: -15px;");let a=document.createElement("img");a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAgVJREFUaAXtmU2KwkAQhZ0hQbyDu7mIB3PhwoN5EXfeIYguJo9JQRMydurnNYxTDTH+dNWr71VD2mSzyZEOpAPpQDqQDqQD6UA6kA6kA80dOJ1O++Px+NVKGFrQ9Oh9WoMhPAzD5fF4XFpAQwNa0PRAf1iABXaMle7e+r4/nM/nqyVfLUZgx3nS3etutzuMddxqsfPf1cALsJKTAr0AK3omaPWSfj6f21ERx3zso5f3C1hob6da5nW8/KzuMLJVCgnpNEvDBMyGZsGibjMwC5oJ6waOhmbDhgBHQbeADQP2QreCDQW2QreEDQfWQreGpQCvhcY8bFTGk2wX8ZWMkGu5JCvPrstSmWj+vta9aX5TWGjSgJG8Ao0p80HrrAhRgSGigKbDoh468EroJrCoRf1vCUF/edA7/K+WtAJWFg19adM6XIGVWzPvcVmqweL+F1r6FhuPNbBys08zV9a89xy6pC0AlhgPdBiwp3BPrBY+BDii4Igca+DdwJGFRub6Dd4FzCiQkbOENwMzC2PmNgEzC5JusDTUwKxCBLQ8M7TU/5a6rruPReGYj/B9MDYo065MtqKl5n2qpfyu+l7dYWRceIIYDltWvtBp05ND5DQBI7CA3jKfDUMLo4C+W58N/2RyvAIahThSqEKhBU1VUE5OB9KBdCAdSAfSgXQgHUgH0oEQB74BG1sUIwNoL3cAAAAASUVORK5CYII=",a.setAttribute("style","height:100%; width:100%;"),o.appendChild(a),i.appendChild(o);let r=document.createElement("img");r.className="pop-preview-image",i.appendChild(r),t.appendChild(i),this.previewImageModal=t,this.previewImage=r,window.addEventListener("keydown",this.closeOnEsc.bind(this)),document.body.appendChild(t)},destroy(){this.previewImageModal&&(this.close(),this.previewImageModal.parentNode.removeChild(this.previewImageModal),this.previewImageModal=null,window.removeEventListener("keydown",this.closeOnEsc.bind(this)))},open(e){this.previewImage.src=e,document.documentElement.style.overflow="hidden",this.previewImageModal.style.display="flex",this.previewImage.style.display="block"},close(){document.documentElement.style.overflow="";let e="display: none;";this.previewImageModal.setAttribute("style",e),this.previewImage.setAttribute("style",e)},closeOnEsc(e){27===e.keyCode&&this.close()}},b={currentLocale:null,translations:{en:{personalize_button:"Personalize",unavailable:"Unavailable",preview_button:"Preview",personalize_title:"Create a personalized design",select_tip:"Please select product options before personalize.",variant_tip:"Note: Your currently selected color and size cannot be changed after proceeding to the next step."},zh:{personalize_button:"定制",unavailable:"不可用",preview_button:"预览",personalize_title:"创建定制产品",select_tip:"定制前请先选择商品属性",variant_tip:"注意：您当前所选的属性就是微定后加入购物车的属性，选择后不再更改。"},ja:{personalize_button:"パーソナライズ",unavailable:"利用不可",preview_button:"プレビュー",personalize_title:"パーソナライズデザインを作成する",select_tip:"パーソナライズする前に製品オプションを選択してください。",variant_tip:"注意：次のステップに進んだ後、現在選択されている色とサイズは変更できません。"},af:{personalize_button:"Persoonlik maak",unavailable:"UnavailOnbeskikbaarable",preview_button:"Voorvertoning",personalize_title:"Skep 'n gepersonaliseerde ontwerp",not_select_tip:"Kies asseblief produkopsies voordat jy dit persoonlik maak.",variant_tip:"Nota: Jou huidig gekose kleur en grootte kan nie verander word nadat jy na die volgende stap gegaan het nie."},de:{personalize_button:"Personalisieren",unavailable:"Unverf\xfcgbar",preview_button:"Vorschau",personalize_title:"Erstellen Sie ein personalisiertes Design",select_tip:"Bitte w\xe4hlen Sie Produktoptionen aus, bevor Sie personalisieren.",variant_tip:"Hinweis: Ihre aktuell ausgew\xe4hlte Farbe und Gr\xf6\xdfe k\xf6nnen nach dem Fortfahren zum n\xe4chsten Schritt nicht mehr ge\xe4ndert werden."},es:{personalize_button:"Personalizar",unavailable:"Indisponible",preview_button:"Vista previa",personalize_title:"Crear un dise\xf1o personalizado",select_tip:"Por favor, seleccione las opciones del producto antes de personalizar.",variant_tip:"Nota: El color y tama\xf1o seleccionados actualmente no se pueden cambiar despu\xe9s de proceder al siguiente paso."},fr:{personalize_button:"Personnaliser",unavailable:"Indisponible",preview_button:"Aper\xe7u",personalize_title:"Cr\xe9er un design personnalis\xe9",select_tip:"Veuillez s\xe9lectionner les options du produit avant de personnaliser.",variant_tip:"Remarque : La couleur et la taille actuellement s\xe9lectionn\xe9es ne peuvent pas \xeatre modifi\xe9es apr\xe8s avoir proc\xe9d\xe9 \xe0 l'\xe9tape suivante."},it:{personalize_button:"Personalizza",unavailable:"Indisponibile",preview_button:"Anteprima",personalize_title:"Crea un design personalizzato",select_tip:"Si prega di selezionare le opzioni del prodotto prima di personalizzare.",variant_tip:"Nota: Il colore e la taglia attualmente selezionati non possono essere modificati dopo aver proceduto al passaggio successivo."},ru:{personalize_button:"Персонализировать",unavailable:"Недоступно",preview_button:"Предварительный просмотр",personalize_title:"Создать персонализированный дизайн",select_tip:"Пожалуйста, выберите опции продукта перед персонализацией.",variant_tip:"Примечание: выбранный вами цвет и размер не могут быть изменены после перехода к следующему шагу."}},formatLocale(e){let t=e?.split("-")?.[0]??"en";return this.translations[t]?t:"en"},getLocale(){let e=window?.Shopify?.locale||document?.documentElement?.lang;return this.formatLocale(e)},translate(e){return this.currentLocale||(this.currentLocale=this.getLocale()),this.translations[this.currentLocale][e]||""}};({dataElement:null,form:null,addToCartButton:null,clonedAddToCartButton:null,previewButton:null,addToCartButtonLoadingElement:null,clonedAddToCartButtonLoadingElement:null,previewButtonLoadingElement:null,isSubmitButton:!0,playgroundWrapElement:null,skeleton:null,variantElement:null,personalizeButton:null,mainImage:null,targetThumb:null,preview:"",locale:"en",designInfo:{sku:null},config:{type:"LessApp",apiUrl:null,storeId:null,canDirectPurchase:!0},designSettings:null,integrationType:"iframe",isIframeType:!0,timer:null,hasClickPreviewButton:!1,iframe:null,modal:null,initLocale(){b.currentLocale=b.getLocale(),this.locale=b.currentLocale},getAddToCartButton(e){this.isSubmitButton=!0;let t=e.querySelectorAll('[type="submit"]');0===t.length&&(t=this.findCartButtons(e),this.isSubmitButton=!1),window.popLog?.log("addToCartButtonElements",t);let i=null;for(let e of t)if(this.isElementVisible(e)){i=e;break}return i},findCartButtons(e){let t=e.querySelectorAll("button"),i=[];for(let e of t){let t=e.innerHTML;if(t.includes("cart")||t.includes("Cart")){i.push(e);break}}return i},isElementVisible:e=>!!(e.offsetWidth>0)||!!(e.offsetHeight>0)||!!(e.getClientRects().length>0),isTargetForm(e){return!!e&&!!this.isElementVisible(e)&&(window?.Shopify?.theme?.schema_name!=="Zalify"||!!e.querySelector('button#AddToCart[type="submit"]'))},reportError(e){let t=window.location.href,i=navigator.userAgent,n=(e=>{let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i)|0;return t.toString(16)})(`${e}${t}${i}`),o=window.POPErrorHashs||[];if(o.includes(n))return void window.popLog?.log("already report error",e);o.push(n),window.POPErrorHashs=o;let{width:a,height:r}=window.screen,s={value:e,stack:e,page_info:{url:t,user_agent:i,window_screen:`${a}x${r}`,document_screen:`${document.documentElement.clientWidth||document.body.clientWidth}x${document.documentElement.clientHeight||document.body.clientHeight}`}};new FormData().append("json",JSON.stringify(s)),window.popLog?.log("report error",e)},findFormAndAddToCartButton(){let e=null,t=null,i=null;if(this.isShopifyPage()){for(let n of e=document.querySelectorAll('form[action$="/cart/add"]'))if(this.isTargetForm(n)&&(i=this.getAddToCartButton(n))){t=n;break}}else for(let n of e=document.querySelectorAll("form.cart"))if(i=n.querySelector("button[type=submit].single_add_to_cart_button")){t=n;break}return e&&0!==e.length&&(window.popLog?.log("formElements",e),t)?i?(window.popLog?.log("Form AddToCartButton found",t,i),this.form=t,this.addToCartButton=i,!0):(this.reportError("Invalid form: no add to cart button found!"),!1):(this.reportError("Invalid form: no form found!"),!1)},addButtonLoadingElement(e){for(let t of e){let e=this[`${t}Button`];if(!e)continue;"relative"!==window.getComputedStyle(e).position&&(e.style.position="relative");let i=c("style");i.innerHTML=".pop-loading-hidden{display:none !important;}.pop-loading{position:absolute;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.2);cursor:not-allowed;z-index:1;}.pop-loading-inner-wrap{width: 100%;height: 100%;pointer-events:none;display:flex;align-items:center;justify-content:center;}.pop-loading-icon{animation:spin 1s linear infinite;width:20px;height:20px;color:#0d0d0d;}@keyframes spin{to{transform:rotate(360deg);}}",e.appendChild(i);let n=c("div",{class:"pop-loading pop-loading-hidden"},{},'<div class="pop-loading-inner-wrap"><svg class="pop-loading-icon"xmlns="http://www.w3.org/2000/svg"fill="none"viewBox="0 0 24 24"><circle style="opacity: 0.25;"cx="12"cy="12"r="10"stroke="currentColor"stroke-width="4"></circle><path style="opacity: 0.75;"fill="currentColor"d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div>');e.appendChild(n),this[`${t}ButtonLoadingElement`]=n}},changePlaygroundWrapDisableStatus(e){let t="pop-wrapper-disabled";e?this.playgroundWrapElement.classList.add(t):this.playgroundWrapElement.classList.remove(t)},changeAllButtonDisableStatus(e){this.clonedAddToCartButton&&(this.clonedAddToCartButton.disabled=e),this.previewButton&&(this.previewButton.disabled=e)},changeAllButtonLoadingElement(e){this.changeButtonLoadingElement(e,"addToCart"),this.changeButtonLoadingElement(e,"clonedAddToCart"),this.changeButtonLoadingElement(e,"preview")},changeButtonLoadingElement(e,t="addToCart"){let i=this[`${t}ButtonLoadingElement`];if(!i)return;let n="pop-loading-hidden";e?i.classList.remove(n):i.classList.add(n)},isLoadingStatus(e){let t=this[`${e}ButtonLoadingElement`];return!!t&&!t?.classList?.contains("pop-loading-hidden")},createSameThemeButton(e,t){let i=document.createElement("button");return i.innerText=b.translate(t),i.setAttribute("type","button"),i.setAttribute("id",e),this.cloneStyle(this.addToCartButton,i),i},insertButton(){let e=this.createSameThemeButton("PopCustomizeProductBtn","personalize_button");this.addToCartButton.parentNode.insertBefore(e,this.addToCartButton),this.personalizeButton=e,this.addButtonEvent()},listenFormChanged(){u(this.form,"change",async e=>{let t=e?.target;window.popLog?.log("form changed",t),-1!==["SELECT","INPUT"].indexOf(t?.tagName.toUpperCase())&&(await s(300),this.setSelectedDesignInfo())})},_showSelectVariantTip(){return!(!this.variantElement||this.getVariantIdToString(this.variantElement))&&(alert(b.translate("select_tip")),!0)},addButtonEvent(){this.personalizeButton.onclick=e=>{if(e.preventDefault(),e.stopPropagation(),this.setSelectedDesignInfo(),this._showSelectVariantTip())return;if(this.getVariants().length>1&&!confirm(b.translate("variant_tip")))return!1;let t=this.getIframeUrl();document.body.appendChild(this.createModal(t)),this.iframe.onload=()=>{p(this.iframe.contentWindow,"PopSetDesignSettings",{designSettings:this.designSettings})}}},getIframeUrl(){return o+"?"+new URLSearchParams({third_product_id:window?.ShopifyAnalytics?.meta?.product?.id??null,type:this.config.type,store_id:this.config.storeId,pop_api:this.config.apiUrl,sku:this.designInfo.sku,locale:this.locale}).toString()},setSelectedDesignInfo(){let e=this.getSelectedVariant();if(!e)return;window.popLog?.log("variant",e);let t=this.getSku(e);t&&(this.designInfo.sku=t),window.popLog?.log("sku",t),window?.POPChangeSku?.(this.designInfo.sku)},getSku(e){let i=t("pop_sku");return null!==i?i:e?.sku??""},getVariants(){return this.isShopifyPage()?window?.ShopifyAnalytics?.meta?.product?.variants??[]:JSON.parse(this.form?.dataset?.product_variations??"[]")},getVariant(e){let t=this.getVariants();window.popLog?.log("variants",t);let i=this.isShopifyPage()?"id":"variation_id";return e&&"0"!==e?t.find(t=>t[i]?.toString()===e.toString()):(window.popLog?.log("找不到用第一个属性",t?.[0]),t?.[0])},_listenVariantValueChanged(e){e&&d(()=>{this.setSelectedDesignInfo()},e,{attributes:!0})},getVariantIdToString:e=>e?.value?.toString()??"",findVariantElement(){for(let e of['input[name="id"]','input[name="variation_id"]','select[name="id"]','option[selected="selected"]']){let t=this.form.querySelector(e);if(t){this.variantElement=t;break}}this.variantElement&&this._listenVariantValueChanged(this.variantElement)},getSelectedVariant(){let e=this.getVariantIdToString(this.variantElement);window.popLog?.log("variantIdString",e);let t=this.getVariant(e);return t||window.popLog?.log("找不到属性 即单属性"),t},insertOrUpdateHiddenField(e,t){let i=this.form.querySelector(`[name="${e}"]`);i||((i=document.createElement("input")).type="hidden",i.name=e,this.form.appendChild(i)),i.value=t,window.popLog?.log("insertOrUpdateHiddenField",i)},removeHiddenField(){for(let e of["properties[pop]"]){let t=this.form.querySelector(`[name="${e}"]`);t&&this.form.removeChild(t)}},_getCustomizationFieldData:e=>({name:"pop",value:h+e}),insertCustomizationField(e){let{hash:t,sample:i=""}=e,{name:n,value:o}=this._getCustomizationFieldData(t);this.insertOrUpdateHiddenField(`properties[${n}]`,o),this.isShopifyPage()||this.insertOrUpdateHiddenField("properties[pop_image]",i),window.popLog?.log("insertCustomizationField")},resetTimer(){this.timer&&clearTimeout(this.timer)},_findPreviewImage(){let e=null;for(let t of[".wp-post-image",".image-magnify-lightbox"]){let i=document.querySelectorAll(t);i?.[0]&&(e=i?.[0]??null)}return e},_updatePreviewImage(e){this.preview=e,this.targetThumb?.click()},listenEvent(){u(window,"message",e=>{let t=e?.data;if(!this.isIframeType&&t?.action==="PopAppLoaded"&&this.skeleton&&this.skeleton.parentNode.removeChild(this.skeleton),!this.isIframeType&&t?.action==="PopGeneratingSamplePreview"){let e=t.status;window.popLog?.log("PopGeneratingSamplePreview",e);let i=e=>{this.changeAllButtonDisableStatus(e),this.changeAllButtonLoadingElement(e)};if(this.resetTimer(),!0===e){this.timer=setTimeout(()=>{i(!0)},300);return}i(!1)}if(!this.isIframeType&&t?.action==="PopPreviewSample"){let e=this.hasClickPreviewButton;this.hasClickPreviewButton=!1;let i=t?.sample??"";if(!i)return void window.popLog?.error("效果图生成失败");this.preview=i,e&&v.open(this.preview)}if(t?.action==="PopProductCustomized"){window.popLog?.log("PopProductCustomized");let e=t?.hash;this.interceptAddToCartFetch(e),this.insertCustomizationField(t),this.isSubmitButton?this.addToCartButton.click():this.form.submit(),this.reportEmbedProduct({add_to_cart_hash:e}),this.isIframeType&&this.closeModal()}})},getIntegrationType(){return this.designSettings.integration_type||"iframe"},insertPreviewButton(){let e=this.createSameThemeButton("PopPreviewProductBtn","preview_button");v.create(),e.onclick=e=>{this.isLoadingStatus("preview")||(e.preventDefault(),e.stopPropagation(),window?.POPUpdateSample?.(),this.hasClickPreviewButton=!0,window.POPLastAction="preview")},this.previewButton=e,this.addToCartButton.parentNode.insertBefore(e,this.addToCartButton),this.addButtonLoadingElement(["preview"]),this.previewButton.disabled=!0},async insertPlayground(){let e=c("div",{id:"popLessAppWrap","data-pop-api":this.config.apiUrl,"data-store-id":this.config.storeId,"data-sku":this.designInfo.sku,"data-locale":this.locale,style:"width: 100%;margin-bottom: 10px;"}),t=c("div",{id:w});e.appendChild(t);let i=c("style");i.innerHTML=".pop-skeleton{display: block !important;background:#f5f5f5;background-image:linear-gradient(to right,#eee 8%,#ddd 18%,#eee 33%);background-size:800px;animation:shimmer 1.5s infinite;height:50px;border-radius:5px;}@keyframes shimmer{0%{background-position:-400px 0;}100%{background-position:400px 0;}}",e.appendChild(i);let n=c("div",{class:"pop-skeleton"});e.appendChild(n),this.skeleton=n,this.addToCartButton.parentNode.insertBefore(e,this.addToCartButton);let o=c("style");i.innerHTML=".pop-wrapper-disabled{opacity:0.5;cursor:not-allowed;}.pop-wrapper-disabled > div{pointer-events:none;}",e.parentNode.appendChild(o),this.playgroundWrapElement=e,window?.POPTemplateDesignerVue?.$mount(`#${w}`),this.insertPreviewButton(),p(window,"PopSetDesignSettings",{designSettings:this.designSettings}),this.interceptAddToCardButtonClick()},async insertContent(){if(this.integrationType=this.getIntegrationType(),this.isIframeType="iframe"===this.integrationType,this.isIframeType){await this.insertButton(),this._hideAddToCartButton();return}(()=>{if(window.posthog)return;let e=document.createElement("script");e.type="text/javascript",e.text=`!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_T0so8DzFAAzQk3yCkgxCgiWb8pQLdAWld0loFyKqjBK',{
      api_host:'https://app.posthog.com',
      session_recording: {
        maskAllInputs: false,
        maskInputOptions: {
          password: true, // Highly recommended as a minimum!!
        }
      }
    });`,document.head.appendChild(e)})(),await this.insertPlayground()},interceptAddToCardButtonClick(){let e=this.addToCartButton;if(!e)return;let t=!1;e.onclick=async e=>{if(t){t=!1;return}if(!this.isLoadingStatus("addToCart")&&(t=!0,window.popLog?.log("点击 addToCartButton"),e.preventDefault(),!this._showSelectVariantTip())){window.POPLastAction="addToCartButton",this.changeButtonLoadingElement(!0,"addToCart");try{await window?.POPSaveDesign?.()}catch(e){window.popLog?.error("POPSaveDesign error",e);return}finally{this.changeButtonLoadingElement(!1,"addToCart")}}}},interceptClonedAddToCardButtonClick(){let e=this.clonedAddToCartButton;e&&(e.onclick=async e=>{if(!this.isLoadingStatus("clonedAddToCart")&&(window.popLog?.log("点击 clonedAddToCartButton"),e.preventDefault(),!this._showSelectVariantTip())){window.POPLastAction="clonedAddToCart",this.changeButtonLoadingElement(!0,"clonedAddToCart");try{await window?.POPSaveDesign?.()}catch(e){window.popLog?.error("POPSaveDesign error",e);return}finally{this.changeButtonLoadingElement(!1,"clonedAddToCart")}}})},cloneStyle(e,t){let i=t.classList;for(;i.length>0;){let e=i.item(0);i.remove(e)}let n=getComputedStyle(e).width.replace("px","")/getComputedStyle(e.parentElement).width.replace("px","")*100+"%";t.style.width=n,t.style.cursor="pointer";let o="pop-cloned-button-"+Date.now();t.classList.add(o);let a=document.createElement("style");a.textContent=`.${o} {
        ${this._getComputedStyle(e,null,["width","pointer-events","cursor","opacity"])}
      }.${o}:hover {
        ${this._getComputedStyle(e,":hover")}
      }.${o}:focus {
        ${this._getComputedStyle(e,":focus")}
      }.${o}::before {
        ${this._getComputedStyle(e,"::before")}
      }.${o}::after {
        ${this._getComputedStyle(e,"::after")}
      }`,e.parentNode.appendChild(a)},_getComputedStyle(e,t,i=[]){let n=window.getComputedStyle(e,t),o="";for(let e of n)i.includes(e)||(o+=`${e}: ${n.getPropertyValue(e)}; `);return o},insertClonedAddToCartButton(){let e=this.addToCartButton.cloneNode(!0);e.removeAttribute("type"),e.removeAttribute("name"),e.removeAttribute("value"),e.removeAttribute("id",""),e.setAttribute("type","button"),e.setAttribute("id","PopAddToCartProductBtn"),this.cloneStyle(this.addToCartButton,e),e.removeChild(e.querySelector(".pop-loading")),this._hideAddToCartButton(),this.addToCartButton.parentNode.insertBefore(e,this.addToCartButton),this.clonedAddToCartButton=e,this.addButtonLoadingElement(["clonedAddToCart"])},reportEmbedProduct(e={}){if("embed"!==this.getIntegrationType())return;let t={product_url:window.location.href,store_id:this.config.storeId,sku:this.designInfo.sku,...e};fetch(`${this.config.apiUrl}/api/v1/websites/blackhole`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)})},getShopifyDomain(){let e=t("pop_domain");return null!==e?e:window?.Shopify?.shop||""},getShopifyDefaultSku:()=>window?.ShopifyAnalytics?.meta?.product?.variants?.[0]?.sku||"",popaxiosRequest(t){let{createAxios:i}=window.popaxios,n=window.POPAxiosService||i();window.POPAxiosService||(window.POPAxiosService=n);let o={headers:{...t?.headers||{},...e}};return n({...t,...o})},async requestDesignSettings(){let e={use_base64:1,sku:this.designInfo.sku,domain:this.getShopifyDomain(),store_id:this.config.storeId||""};if(!e.sku||!e.domain&&!e.store_id)return!1;let t=null;try{t=(await this.popaxiosRequest({method:"get",url:`${this.config.apiUrl}/api/v1/products/template_designers/design_settings`,params:e,headers:{accept:"application/json","accept-language":this.locale}})).data}catch(e){return window.popLog?.error(e),!1}return(window.popLog?.log("requestDesignSettings",t),t)?(this.designSettings=t,this.config.type="LessApp",this.config.canDirectPurchase=t.support_direct_purchase,this.config.storeId=t.store_id,!0):(window.popLog?.error("未获取到数据配置"),!1)},interceptAddToCartFetch(e){let t;if(!window.BSS_PO)return;let{name:i,value:n}=this._getCustomizationFieldData(e);t=window.fetch,window.fetch=function(){if(arguments?.[0]==="/cart/add.js"&&arguments?.[1].method==="POST"){window.popLog?.log("originalFetch arguments",arguments);let e=arguments[1].body;window.popLog?.log("body",e),arguments[1].body=(e=>{if(!e)return e;let t=e,o=JSON.parse(t);return o.items[0].properties[i]?e:(o&&(o.items[0].properties[i]=n),t=JSON.stringify(o))})(e),window.popLog?.log("modified Fetch arguments",arguments)}return t.apply(this,arguments)}},_listenAddToCartChanged(e){e&&d(()=>{let t=e.disabled;if(this.playgroundWrapElement&&this.changePlaygroundWrapDisableStatus(t),this.personalizeButton){this.personalizeButton.disabled=t;let i=e.innerText.toLowerCase().includes("unavailable")&&t,n=e=>{e?this.personalizeButton.innerText=b.translate("unavailable"):this.personalizeButton.innerText=b.translate("personalize_button")};if(this.resetTimer(),!0===i){this.timer=setTimeout(()=>{n(!0)},300);return}n(!1)}this.clonedAddToCartButton&&(this.clonedAddToCartButton.disabled=t),this.previewButton&&(this.previewButton.disabled=t)},e,{attributes:!0,childList:!0,subtree:!0})},isShopifyPage:()=>!!window?.ShopifyAnalytics,isProductPage(){return window?.ShopifyAnalytics?.meta?.page?.pageType==="product"||(this.dataElement=document.querySelector(".pop-support-template-designer")||null,null!==this.dataElement)},initDefaultConfig(){if(this.isShopifyPage())return this.designInfo.sku=this.getShopifyDefaultSku()||"",this.config.apiUrl=n(),!0;if(!this.dataElement)return!1;let e=this.dataElement.dataset;return this.designInfo.sku=e.popSku||"",this.config.storeId=e.popStoreId||"",this.config.apiUrl=e.popApiUrl||"",window.popLog?.log("default sku",this.designInfo.sku),!!this.config.apiUrl},async init(){if(!this.isProductPage())return;let e=this.findFormAndAddToCartButton();if(!1!==e&&!1!==(e=this.initDefaultConfig())){await s(300),this.findVariantElement(),this.setSelectedDesignInfo();try{await l(document.body,a),await l(this.addToCartButton.parentNode,r)}catch{return}await this.requestDesignSettings()&&(this._listenAddToCartChanged(this.addToCartButton),this.addButtonLoadingElement(["addToCart"]),this.reportEmbedProduct(),this.listenFormChanged(),this.listenEvent(),this.insertContent())}},initLivePreview(){let{mainImage:e,targetThumb:t}=y.finder();return!!e&&(this.mainImage=e,this.targetThumb=t,!0)},async start(){this.initLocale(),await this.init()},_hideAddToCartButton(){this.designSettings&&this.addToCartButton&&this.isIframeType&&(this.config.canDirectPurchase||(this.addToCartButton.style.display="none"))},createModal(e){this.closeModal();var t=!!window.navigator&&!!window.navigator.userAgent&&window.navigator.userAgent;t&&t.match(/iPhone|iPad|iPod/i);var i=document.createElement("div");i.className="pop-customize-modal",i.setAttribute("style","position: fixed; z-index: 2147483648; top: 0; width: 100%; height: 100%; left: 0; background: rgba(0, 0 , 0, 0.6); box-sizing: border-box; display: flex; justify-content: center; align-items: center;");var n=document.createElement("div");n.setAttribute("style","padding: 15px; border-bottom: 1px solid #e5e5e5; overflow:hidden; position:absolute; top:0; left:0; width:100%; box-sizing: border-box;");var o=document.createElement("span");o.onclick=this.closeModal.bind(this),o.setAttribute("style","height:30px; width:30px; cursor:pointer; border:0px; background:0 0; padding:0; -webkit-appearance:none; color:#000; float:right; background:none;");var a=document.createElement("img");a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAgVJREFUaAXtmU2KwkAQhZ0hQbyDu7mIB3PhwoN5EXfeIYguJo9JQRMydurnNYxTDTH+dNWr71VD2mSzyZEOpAPpQDqQDqQD6UA6kA6kA80dOJ1O++Px+NVKGFrQ9Oh9WoMhPAzD5fF4XFpAQwNa0PRAf1iABXaMle7e+r4/nM/nqyVfLUZgx3nS3etutzuMddxqsfPf1cALsJKTAr0AK3omaPWSfj6f21ERx3zso5f3C1hob6da5nW8/KzuMLJVCgnpNEvDBMyGZsGibjMwC5oJ6waOhmbDhgBHQbeADQP2QreCDQW2QreEDQfWQreGpQCvhcY8bFTGk2wX8ZWMkGu5JCvPrstSmWj+vta9aX5TWGjSgJG8Ao0p80HrrAhRgSGigKbDoh468EroJrCoRf1vCUF/edA7/K+WtAJWFg19adM6XIGVWzPvcVmqweL+F1r6FhuPNbBys08zV9a89xy6pC0AlhgPdBiwp3BPrBY+BDii4Igca+DdwJGFRub6Dd4FzCiQkbOENwMzC2PmNgEzC5JusDTUwKxCBLQ8M7TU/5a6rruPReGYj/B9MDYo065MtqKl5n2qpfyu+l7dYWRceIIYDltWvtBp05ND5DQBI7CA3jKfDUMLo4C+W58N/2RyvAIahThSqEKhBU1VUE5OB9KBdCAdSAfSgXQgHUgH0oEQB74BG1sUIwNoL3cAAAAASUVORK5CYII=",a.setAttribute("style","height:30px; width:30px;"),o.appendChild(a),n.appendChild(o);var r=document.createElement("h4");r.className="pop-product-customized__header-title",r.setAttribute("style","float: left;font-weight:bold;font-size:20px;color:#222;line-height:30px;margin:0px;width: auto;clear: none;"),r.innerText=b.translate("personalize_title"),n.appendChild(r);var s=document.createElement("div");s.className="pop-product-customized__content",s.setAttribute("style","background-color: #fff; width: 100%; height: 100%;overflow:hidden;position:relative"),s.appendChild(n);var l=document.createElement("style");l.innerHTML="@media screen and (max-width: 768px) { .pop-product-customized__header-title {font-size: 16px !important;} }",l.innerHTML=l.innerHTML+"@media screen and (min-width: 768px) {.pop-product-customized__content {max-width: 500px; max-height: 90vh; border-radius: 10px;}}",l.innerHTML=l.innerHTML+".pop-scaling-squares-spinner-wrap{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.pop-scaling-squares-spinner,.pop-scaling-squares-spinner *{box-sizing:border-box}.pop-scaling-squares-spinner{height:65px;width:65px;display:flex;flex-direction:row;align-items:center;justify-content:center;animation:pop-scaling-squares-animation 1250ms;animation-iteration-count:infinite;transform:rotate(0deg)}.pop-scaling-squares-spinner .pop-square{display:block;height:calc(65px * 0.25 / 1.3);width:calc(65px * 0.25 / 1.3);margin-right:auto;margin-left:auto;border:calc(65px * 0.04 / 1.3) solid #0cc3ce;position:absolute;animation-duration:1250ms;animation-iteration-count:infinite}.pop-scaling-squares-spinner .pop-square:nth-child(1){animation-name:pop-scaling-squares-spinner-animation-child-1}.pop-scaling-squares-spinner .pop-square:nth-child(2){animation-name:pop-scaling-squares-spinner-animation-child-2}.pop-scaling-squares-spinner .pop-square:nth-child(3){animation-name:pop-scaling-squares-spinner-animation-child-3}.pop-scaling-squares-spinner .pop-square:nth-child(4){animation-name:pop-scaling-squares-spinner-animation-child-4}@keyframes pop-scaling-squares-animation{50%{transform:rotate(90deg)}100%{transform:rotate(180deg)}}@keyframes pop-scaling-squares-spinner-animation-child-1{50%{transform:translate(150%,150%) scale(2,2)}}@keyframes pop-scaling-squares-spinner-animation-child-2{50%{transform:translate(-150%,150%) scale(2,2)}}@keyframes pop-scaling-squares-spinner-animation-child-3{50%{transform:translate(-150%,-150%) scale(2,2)}}@keyframes pop-scaling-squares-spinner-animation-child-4{50%{transform:translate(150%,-150%) scale(2,2)}}",s.appendChild(l),i.appendChild(s);let d=document.createElement("div");d.classList.add("pop-scaling-squares-spinner-wrap"),d.innerHTML='<div class="pop-scaling-squares-spinner"><div class="pop-square"></div><div class="pop-square"></div><div class="pop-square"></div><div class="pop-square"></div></div>';var p=document.createElement("div");p.setAttribute("style","-webkit-overflow-scrolling: touch; height: calc(100% - 61px); top: 61px; box-sizing: border-box; position: absolute; width: 100%;"),p.appendChild(d),s.appendChild(p);var u=document.createElement("iframe");return u.src=e,u.width="100%",u.height="100%",u.setAttribute("scrolling","no"),u.setAttribute("style","position:relative; border: 0; box-sizing: border-box;"),p.appendChild(u),this.iframe=u,this.modal=i,document.documentElement.style.overflow="hidden",i},closeModal(){this.modal&&(this.modal.parentNode.removeChild(this.modal),this.modal=null,document.documentElement.style.overflow="")}}).start(),({apiUrl:"",init(){if(this.apiUrl=n(),this.apiUrl.startsWith("https://")){this._processCustomizedImages();var e=this;new MutationObserver(function(t){let i=!0;t.forEach(function(){e._processCustomizedImages(i),i=!1})}).observe(document.body,{childList:!0,subtree:!0})}},_processCustomizedImages(e=!1){var t=document.querySelectorAll('form[action="/cart"]');t=t.length?t:document.querySelectorAll(`form[action$="${document.location.origin}${document.location.pathname}"]`),this._replaceImagesInElement(t,e);var i=document.querySelectorAll(".qodef-shopping-cart-dropdown");this._replaceImagesInElement(i,e);var n=document.querySelectorAll(".woocommerce-mini-cart");this._replaceImagesInElement(n,e)},_replaceImagesInElement(e,t=!1){for(var i=0;i<e.length;i++){var n=e[i],o=n.classList.contains(g);(!1===o||!0===t)&&(!1===o&&n.classList.add(g),this._parseElement(n,e=>{this._findAndRemoveCustomizeKeyInfo(e)}))}},_parseElement(e,t){for(var i=e.childNodes,n=0;n<i.length;n++){var o=i[n];o.nodeType==Node.TEXT_NODE?t&&t(o):this._parseElement(o,t)}},_findAndRemoveCustomizeKeyInfo(e){let t=e.textContent.trim();if(t.startsWith("pop:")&&(e.parentNode.style.display="none"),!t.startsWith(h)&&!t.startsWith("pop:"))return;let i=t.split("_").pop();i&&(this._getHashImage(i,e),e.parentNode.style.display="none")},replaceImage(e,t){this._findAndReplaceImage(e.parentNode,t,!0),this._findAndReplaceLinkImage(e.parentNode,t,!0)},async _getHashImage(e,t){if(!f[e]){if(m[e]){let i=m[e];if(i)return void this.replaceImage(t.parentNode,i)}f[e]=!0;var i=new XMLHttpRequest;i.onreadystatechange=(function(e,t,i){if(4==this.readyState&&200==this.status){var n=JSON.parse(this.responseText).data[t];n&&(m[t]=n,i.replaceImage(e.parentNode,n),f[t]=!1)}}).bind(i,t,e,this);var n=`${this.apiUrl}/api/v1/products/template_designers/samples?api_key=anZ0zQyFbj7gSuca&hashs[]=${e}`;i.open("GET",n,!0),i.setRequestHeader("Accept","application/json"),i.send()}},_findAndReplaceImage(e,t,i){return this._findAndReplaceLoop(e,t,i,(e,t)=>"IMG"==e.tagName&&(e.src!==t&&(e.src=t,e.setAttribute("data-widths","[800]"),e.setAttribute("data-srcset",t+" 800w"),e.setAttribute("srcset",t+" 800w")),e.setAttribute("style","cursor: zoom-in"),e.onclick=e=>{e.preventDefault(),v.create(),v.open(t)},!0))},_findAndReplaceLinkImage(e,t,i){return this._findAndReplaceLoop(e,t,i,function(e,t){return"A"==e.tagName&&e.style.backgroundImage.length>0&&(e.style.backgroundImage="url("+t+")",!0)})},_findAndReplaceLoop(e,t,i,n){if(!e)return!1;if(e.classList.contains(g))return window.popLog?.warn?.("Looks like image was replaced"),!0;for(var o=0;o<e.children.length;o++){var a=e.children[o];if(n(a,t)||this._findAndReplaceLoop(a,t,!1,n))return!0}return!!i&&this._findAndReplaceLoop(e.parentNode,t,!0,n)}}).init()}();